Ã‹
    â€¡+Zi7  Ã£                   Ã³X   â€” d dl Z d dlmZmZmZ d dlmZ d dl Z d dlZd dl	Z	 G dâ€ dÂ«      Z
y)Ã©    N)ÃšhttpÃš
connectionÃšmaster)Ãš Headersc                   Ã³Â¢   â€” e Zd Zdej                  dej                  fdâ€Zdâ€ Zde fdâ€Zd â€ Z	dâ€ Z
d	e
j                  fd
â€Z
d	e
j                  fd
â€Zy)
Ãš
InterceptorÃš	gui_queueÃš
proxy_queuec                 Ã³`   â€” || _         || _        t        j                  Â«       | _        i | _        y )N)r	   r
   Ãš	threadingÃšEventÃšintercept_enabledÃš
live_flows)Ãšselfr	   r
   s      ÃºYC:\Users\nsrin\OneDrive\Desktop\Hacking Tools\proxy-tool\Proxy_tool2\proxy\interceptor.pyÃš__init__zInterceptor.__init__	   s'   â‚¬ Ã˜"Ë†Å’Ã˜&Ë†Ã”Ãœ!*Â§Â¡Ã“!2Ë†Ã”Ã˜Ë†ÂÃ³    c                 Ã³â€š   â€” |j                  d| j                  Â«       t        j                  | j	                  Â«       Â«       y )Nzintercept.toggle)Ãš
add_commandÃštoggle_interceptÃš asyncioÃš
create_taskÃšprocess_proxy_queue)r   Ãšloaders     r   ÃšloadzInterceptor.load   s0   â‚¬ Ã˜Ã—Ã‘Ã-Â¨tÃ—/DÃ‘/DÃ”EÃœÃ—Ã‘ËœDÃ—4Ã‘4Ã“6Ã•7r   Ãšvaluec                 Ã³ÃŒ   â€” | j                   j                  Â«        |r| j                   j                  Â«        y| j                   Â«        | j                  j
                  ddiÂ«       y)z:Command to toggle interception on/off from another thread.ÃštypeÃšclear_interceptN)r   ÃšclearÃšsetÃš_resume_all_pending_flowsr	   Ãšput)r   r   s     r   r   zInterceptor.toggle_intercept   sO   â‚¬ Ã Ã—Ã‘Ã—$Ã‘$Ã”&Ã™
Ã˜Ã—"Ã‘"Ã—&Ã‘&Ã•(Ã° 
Ã—*Ã‘*Ã”,Ã ÂNâ€°NÃ—Ã‘Â Ã(9Ã:Ã•;r   c                 Ã³  â€” t        | j                  j                  Â«       Â«      }d}|D ]  }	 |j                   Â«        |dz
  }Å’ | j                  j                  Â«        y# t        $ r%}t
        d|j                  â€º d|â€º ÂÂ«       Y d}~Å’_d}~ww xY w)z;INSTANTLY resume all pending flows (no delay) + clear dict.r   Ã©   z&interceptor.py: Failed to resume flow z: N)Ãšlistr   ÃšvaluesÃšresumeÃš	ExceptionÃšprintÃšidr    )r   Ãš
pending_flowsÃš
resumed_countÃšflowÃšes        r   r"   z%Interceptor._resume_all_pending_flows   sâ€   â‚¬ Ã¤ËœTÅ¸_â„¢_Ã—3Ã‘3Ã“5Ã“6Ë†
Ã˜Ë†
Ã›!Ë†DÃ°
OÃ˜â€”
â€˜
â€
Ã˜Â Ã‘"â€˜
Ã°  "Ã° 	
Ââ€°Ã—Ã‘Ã•Ã¸Ã´ Ã² 
OÃœÃ>Â¸tÂ¿wÂ¹wÂ¸iÃ€rÃˆ!ÃˆÃMÃ—NÃ‘NÃ»Ã°
OÃºs   Â¬AÃ	BÃ'B Ã‚ Bc           
   Æ’   Ã³Å“  K  â€” 	 	 t        j                  | j                  j                  Â«      Æ’ d {  â€“â€”â€  }t	        |t
        Â«      st
        dt        |Â«      â€º dÂÂ«       Å’\|j                   dÂ«      }|j                   dÂ«      }|dk(  rÃ¼|| j                  v rÃ®| j                  j                  |Â«      }|d   }|d    |j                  _
        |d   |j                  _        |d	   }d
|v sd
|v sd|v r#|j                  d
Â«      r|j                  d
dÂ«      }||j                  _        t!        |d   D Â Âcg c]'  \  } }| j#                  dÂ«      |j#                  dÂ«      fâ€˜Å’) c}} Â«      |j                  _        |j'                  Â«        nâ€¡|dk(  râ€š|| j                  v rt| j                  j                  |Â«      }t(        j*                  j-                  dddt/        t1        dÂ«      Â«      j#                  Â«       dÅ“Â«      |_        |j'                  Â«        ÂÅ’ 7 ÂÅ’Ãšc c}} w # t4        $ r,}	t
        d|	â€º ÂÂ«       dd l}
|
j9                  Â«        Y d }	~	Å’;d }	~	ww xY wÂ­w)Nz>interceptor.py: WARNING - expected dict from proxy_queue, got z
. Ignoring.Ãš flow_idÃš commandÃš forwardÃšdataÃšmethodÃš contentÃšurlz192.168.1.7:5001Ãº	127.0.0.1Ãš	localhostzhttps://z http://Ãš headerszutf-8Ãšdropiâ€œ  s   Dropped by Proxy Tools
   text/plain)s   Content-Types   Content-Lengthz Error in proxy queue processor: r   )r   Ãš	to_threadr
   ÃšgetÃš
isinstanceÃšdictr*   r   r   ÃšpopÃš requestr5   r6   Ãš
startswithÃš replacer7   r   Ãšencoder:   r(   r   ÃšResponseÃšmakeÃšstrÃšlenÃšresponser)   Ãš	tracebackÃš	print_exc)
r   Ãšitemr1   r2   r.   Ãšupdated_dataÃš new_urlÃškÃšvr/   rJ   s
              r   r   zInterceptor.process_proxy_queue*   s  Ã¨ Ã¸â‚¬ Ã˜Ã°+
&Ãœ$Ã—.Ã‘.Â¨tÃ—/?Ã‘/?Ã—/CÃ‘/CÃ“DÃ—DÂÃ¤!Â $Â¬Ã”-ÃœÃZÃ”[_Ã`dÃ“[eÃZfÃfqÃrÃ”sÃ˜Ã Å¸(â„¢(Â 9Ã“-Â Ã˜Å¸(â„¢(Â 9Ã“-Â Ã ËœiÃ’'Â¨GÂ°tÂ·Â±Ã‘,FÃ˜Å¸?â„¢?Ã—.Ã‘.Â¨wÃ“7ÂDÃ˜#'Â¨Â¡<ÂLÃ *6Â°xÃ‘*@ÂDâ€”Lâ€˜LÃ”'Ã˜+7Â¸	Ã‘+BÂDâ€”Lâ€˜LÃ”(Ã *Â¨5Ã‘1ÂGÃ˜)Â¨WÃ‘4Â¸
Ã€wÃ‘8NÃR]ÃahÃ‘RhÃ˜"Ã—-Ã‘-Â¨jÃ”9Ã˜&-Â§oÂ¡oÂ°jÃ€)Ã“&LËœGÃ '.ÂDâ€”Lâ€˜LÃ”$Ãœ+2ÃgsÃt}Ã’g~Ã”3Ã‘g~Ã‘_cÃ_`ÃbcÂ°QÂ·XÂ±XÂ¸gÃ“5FÃˆÃÃ‰ÃQXÃ“HYÃ’4ZÃg~Ã’3Ã³  ,AÂDâ€”Lâ€˜LÃ”(Ã â€”Kâ€˜Kâ€¢MÃ Â Ã’&Â¨7Â°dÂ·oÂ±oÃ‘+EÃ˜Å¸?â„¢?Ã—.Ã‘.Â¨wÃ“7ÂDÃ¤$(Â§MÂ¡MÃ—$6Ã‘$6Ã˜Ã˜0Ã -:Ãœ/2Â´3Ã7OÃ“3PÃ“/QÃ—/XÃ‘/XÃ“/ZÃ±Ã³  %ÂDâ€MÃ° â€”Kâ€˜Kâ€MÃ±O Ã DÃ»Ã³, 4@Ã¸Ã´" Ã² 
&ÃœÃ8Â¸Â¸Ã<Ã”=Ã› Ã˜Ã—#Ã‘#Ã—%Ã‘%Ã»Ã° 
&Ã¼s^   â€šIâ€¦,H Â±H
Â²,H ÃIÃCH Ã„.,H
Ã…B/H Ãˆ	IÃˆ
H ÃˆH Ãˆ	I	Ãˆ"IÃˆ?IÃ‰I	Ã‰	Ir.   c              Æ’   Ã³~  K  â€” d|j                   j                  v ry t        t         j                  Â«       Â«      |_        | j                  j                  Â«       rÃ¤d|j                   j                  vrÃ‹|| j                  |j
                  <   d|j
                  |j                   j                  |j                   j                  t        |j                   j                  j                  Â«       Â«      |j                   j                  dÂ¬Â«      xs dd Å“dÅ“}| j                  j!                  |Â«       |j#                  Â«        y y y Â­w)	NzX-Proxy-Tool-Internalr8   Ãšintercept_requestFÂ©Ãšstrictr   Â©r5   r7   r:   r6   )r   r1   r4   )rA   r:   rG   ÃšuuidÃšuuid4r+   r   Ãšis_setÃšhostr   r5   Ãš
pretty_urlr&   ÃšitemsÃš
get_contentr	   r#   Ãš	interceptÂ©r   r.   Ãšgui_items      r   rA   zInterceptor.requestY   sÃ°   Ã¨ Ã¸â‚¬ Ã 
"Â dÂ§lÂ¡lÃ—&:Ã‘&:Ã‘
:Ã˜Ã¤â€dâ€”jâ€˜jâ€œlÃ“#Ë†Å’ Ã 
Ã—
!Ã‘
!Ã—
(Ã‘
(Ã”
*Â¨{Ã€$Ã‡,Ã,Ã—BSÃ‘BSÃ‘/SÃ˜'+Ë†DÂOâ€°OËœDÅ¸Gâ„¢GÃ‘$Ã° ,Ã˜Å¸7â„¢7Ã "Å¸lâ„¢lÃ—1Ã‘1Ã˜Å¸<â„¢<Ã—2Ã‘2Ãœ#Â DÂ§LÂ¡LÃ—$8Ã‘$8Ã—$>Ã‘$>Ã“$@Ã“AÃ˜#Å¸|â„¢|Ã—7Ã‘7Â¸uÃ7Ã“EÃ’LÃˆÃ±	Ã± 	Ë†HÃ° 
ÂNâ€°NÃ—Ã‘ËœxÃ”(Ã˜ÂNâ€°NÃ•Ã° 0TÃ
*Ã¹s   â€šD;D=c           	      Ã³Ã   â€” t        |dÂ«      s"t        t        j                  Â«       Â«      |_        d|j                  |j
                  j                  |j
                  j                  |j                  r|j                  j                  nd|j                  r5|j                  j                  rt        |j                  j                  Â«      nddÅ“|j
                  j                  |j
                  j                  t        |j
                  j                  j                  Â«       Â«      |j
                  j                  dÂ¬ Â«      xs dd	Å“|j                  r|j                  r|j                  j                  nd|j                  r-t        |j                  j                  j                  Â«       Â«      ng |j                  j                  dÂ¬ Â«      xs dd
Å“nd d
Å“dÅ“}| j                   j#                  |Â«       y )
Nr+   Ãšflow_summaryÃšERRr   )r5   r7   Ãš
status_codeÃšcontent_lengthFrS   r   rU   )rc   r:   r6   )rA   rI   )r   r1   r4   Ãš	full_flow)Ãš hasattrrG   rV   rW   r+   rA   r5   rZ   rI   rc   r6   rH   r&   r:   r[   r\   r	   r#   r^   s      r   rI   zInterceptor.responsep   si  â‚¬ ÃœÂtËœTÃ”"ÃœÅ“$Å¸*â„¢*â€º,Ã“'Ë†DÅ’GÃ° #Ã˜â€”wâ€˜wÃ Å¸,â„¢,Ã—-Ã‘-Ã˜â€”|â€˜|Ã—.Ã‘.Ã˜<@Â¿MÂºMËœtÅ¸}â„¢}Ã—8Ã’8ÃˆuÃ˜@DÃ‡
Ã‚
ÃRVÃ—R_Ã‘R_Ã—RgÃ’RgÂ¤#Â dÂ§mÂ¡mÃ—&;Ã‘&;Ã”"<ÃmnÃ±	Ã° #Å¸lâ„¢lÃ—1Ã‘1Ã˜Å¸<â„¢<Ã—2Ã‘2Ãœ#Â DÂ§LÂ¡LÃ—$8Ã‘$8Ã—$>Ã‘$>Ã“$@Ã“AÃ˜#Å¸|â„¢|Ã—7Ã‘7Â¸uÃ7Ã“EÃ’LÃˆÃ±	Ã° â€”]â€™]Ã°  AEÃ‡
Ã‚
Â 4Â§=Â¡=Ã—#<Ã’#<ÃSXÃ˜FJÃ‡mÃ‚mÅ“tÂ DÂ§MÂ¡MÃ—$9Ã‘$9Ã—$?Ã‘$?Ã“$AÃ”BÃY[Ã˜#Å¸}â„¢}Ã—8Ã‘8Ã€Ã8Ã“FÃ’MÃˆ#Ã² Ã° )-Ã±Ã±
Ë†Ã°. 	
Ââ€°Ã—Ã‘Ëœ8Ã•$r   N)Ãš__name__Ãš
__module__Ãš__qualname__ÃšqueueÃšQueuer   r   Ãšboolr   r"   r   r   ÃšHTTPFlowrA   rI   Â© r   r   r   r      sY   â€ Ã°Â %Â§+Â¡+Ã° Â¸EÂ¿KÂ¹KÃ³ Ã²8Ã°	<Â dÃ³ 	<Ã²
 Ã²-&Ã°^Â $Â§-Â¡-Ã³ Ã°.%ËœTÅ¸]â„¢]Ã´ %r   r   )
r   Ãš	mitmproxyr   r   r   Ãšmitmproxy.httpr   rj   r   rV   r   rn   r   r   Ãš<module>rq      s&   Ã°Ã› ÃŸ .Ã‘ .Ã "Ã› Ã› Ã› 
Ã·C%Ã² C%r   
